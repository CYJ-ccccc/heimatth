# 黑马头条项目总结

## 技术选型

主要技术

- vue

其他技术：

- 项目的搭建：vue-cli
- 管理路由：vue-router
- 管理页面的全局数据：vuex
- 发送网络请求：axios
- 完成页面结构的搭建：vant

## 项目内容

- 登录页面

- 首页

- 搜索页面

- 搜索结果

- 文章详情

- 我的页面

- 个人信息

- 小智机器人

## 开发规范

使用的是 lint”标准规范“

- 1.0 缩进使用两个空格
- 2.0 字符串使用单引号
- 3.0 句未不能以分号结尾
- 4.0 行首不要以 (, [ 开头
- 5.0 关键字后面必须加空格
- 6.0 函数名后面必须加空格
- 7.0 不要有冗余的变量
- 8.0 使用 `===` 替换 `==`
- 9.0 使用浏览器全局变量时加上 window 前辍
- 10.0 注释的双斜杠后面必须加一个空格
- 11.0 行未千万不加空格
- 12.0 每个文件结束之后必须添加一个新的换行
- 13.0 空行不能同时存在多个

## 项目小技能

axios 的二次封装

- 根据环境（开发与生产）的不同设置不同的基地址

- 全局设置 axios 实例添加基地址、并且引入 bigint 插件进行相应的数据格式转换
- 请求拦截器携带登录信息 token
- 响应拦截器，对返回不同错误信息码作出不同的反应

eventbus 代替 vuex 的使用

- 在 vue 中经常涉及到组件之间的传参，但是如果是兄弟组件之间传参太麻烦了，为了解决这个问题可以使用： eventbus
- 封装 bus：在 utils 目录下创建 bus.js，并且创建 var bus = new Vue()；在始组件中传入数剧 bus.$emit('fnname', value)；在目标组件中传取出数据：bus.$on('fnname', value => { // codeing })；在目标组件中生命周期 beforeDenstroy 销毁 bus

websocket 的使用（通讯协议）

- 特点:客户端可以主动向服务端推送信息，服务端也可以向客户端发送信息，很好的让服务端和客户端建立起平等对话
- 使用场景：完成实时聊天

## 项目中遇到的问题

1.token 登录信息 2 个小时的失效问题（设置 2 个小时为了服务器可以容纳更多的用户信息）

- 问题描述：每次登录成功会返回一个只有两个小时的验证 token 及重新获取 token 的验证码，登录后超过 2 小时会有失败获取数据返回
- 问题解决：在 axios 响应拦截器中获取响应错误信息，并且传送刷新 token 验证码重新发送 axios 请求获取新的 token，之后继续执行未完成的请求，将重新接收的结果返回给外界

  2.在发送文章 id 获取更过操作细节的时候，返回数据失败，提示文章 id 不合法

- 问题原因：操作文章时，需发送文章 id，但是返回数据失败，提示文章 id 不合法，是因为浏览器能够编译的最大数值为 9007199254740992（2 的 53 次方），超过这个数字会造成精度丢失,导致传递过去的数据不真实
- 解决方法：在 aixos 封装中引入第三方插件 bigint，在 aixos 实例通过设置 transformResponse 转换数据格式

  3.搜索文章时，请求联想内容会频繁发送网络请求

- 问题原因：监听 input 事件的时候，由于 input 事件是一旦输入框内容发生改变就触发我们绑定的回调函数，在实际操作中页不需要实时监听 input 框输入内容，不仅耗时并且会影响性能

- 解决方法：利用 js 防抖，代码如下：

  ```js
  var timer = null
  element.input = function () {
     clearTimeout(timer) *// 每次进来的时候都将之前的清除掉，如果还没到一秒的时候就将之前的清除掉，这样就不会触发之前setTimeout绑定的事件， 如果超过一秒，之前的事件就会被触发下次进来的时候同样清除之前的timer*
     timer = setTimeout(function () {
   *// 在这里进行我们的操作  这样就不会频繁的进行我们这里面的操作了*

    }, 1000)
  ```
